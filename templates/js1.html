<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
        <title>Lohana Lagna</title>
        <!-- plugins:css -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='vendors/mdi/css/materialdesignicons.min.css')}}"
        />
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='vendors/css/vendor.bundle.base.css')}}"
        />
        <!-- endinject -->
        <!-- Layout styles -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css')}}" />
        <!-- End layout styles -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='images/logo.jpg') }}" />

        <style>
            .switch {
                position: relative;
                display: inline-block;
                width: 100px;
                height: 34px;
            }

            .switch input {
                display: none;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ca2222;
                -webkit-transition: 0.4s;
                transition: 0.4s;
                border-radius: 34px;
            }

            .slider:before {
                position: absolute;
                content: "";
                height: 26px;
                width: 26px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                -webkit-transition: 0.4s;
                transition: 0.4s;
                border-radius: 50%;
            }

            input:checked + .slider {
                background-color: #2ab934;
            }

            input:focus + .slider {
                box-shadow: 0 0 1px #2196f3;
            }

            input:checked + .slider:before {
                -webkit-transform: translateX(26px);
                -ms-transform: translateX(26px);
                transform: translateX(65px);
            }

            /*------ ADDED CSS ---------*/
            .slider:after {
                content: "Unpaid";
                color: white;
                display: block;
                position: absolute;
                transform: translate(-50%, -50%);
                top: 50%;
                left: 53%;
                font-size: 11px;
                font-family: Verdana, sans-serif;
            }

            input:checked + .slider:after {
                content: "Paid";
            }

            /*--------- END --------*/

            .box {
                float: right;
            }

            .pagination {
                float: right;
            }

            .pagination a {
                color: black;
                float: left;
                padding: 8px 16px;
                text-decoration: none;
                transition: background-color 0.3s;
                border: 1px solid #ddd;
                margin: 0 4px;
            }

            .pagination a.active {
                background-color: #4caf50;
                color: white;
                border: 1px solid #4caf50;
            }

            .pagination a:hover:not(.active) {
                background-color: #ddd;
            }

            th {
                color: #ffba5a;
            }
            td {
                color: #0f3d5c;
            }
            .page {
                background-color: #009788;
            }
            #pagination-wrapper {
                margin-left: 10px;
            }

            .loader,
            .loader:after {
                border-radius: 50%;
                width: 10em;
                height: 10em;
            }
            .loader {
                margin: 60px auto;
                font-size: 10px;
                position: relative;
                text-indent: -9999em;
                border-top: 1.1em solid rgba(19, 183, 239, 0.2);
                border-right: 1.1em solid rgba(19, 183, 239, 0.2);
                border-bottom: 1.1em solid rgba(19, 183, 239, 0.2);
                border-left: 1.1em solid #ffffff;
                -webkit-transform: translateZ(0);
                -ms-transform: translateZ(0);
                transform: translateZ(0);
                -webkit-animation: load8 1.1s infinite linear;
                animation: load8 1.1s infinite linear;
            }
            @-webkit-keyframes load8 {
                0% {
                    -webkit-transform: rotate(0deg);
                    transform: rotate(0deg);
                }
                100% {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }
            @keyframes load8 {
                0% {
                    -webkit-transform: rotate(0deg);
                    transform: rotate(0deg);
                }
                100% {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }
            #loadingDiv {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #fff;
            }
            .pagination-button {
                margin-right: 5px;
                padding: 5px 10px;
                border: none;
                background-color: #e2e2e2;
                cursor: pointer;
            }
            .pagination-button.active {
                background-color: #888888;
                color: white;
            }

        </style>
    </head>

    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <div class="container-scroller">
            <!-- partial:partials/_navbar.html -->
            <nav
                class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row"
            >
                <div
                    class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center"
                >
                    <a class="navbar-brand brand-logo" href="{{url_for('home')}}"
                        ><img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="logo"
                    /></a>
                    <a class="navbar-brand brand-logo-mini" href="{{url_for('home')}}"
                        ><img
                            src="{{ url_for('static', filename='images/logo.jpg') }}"
                            alt="logo"
                            style="width: 100%; height: auto"
                    /></a>
                </div>
                <div class="navbar-menu-wrapper d-flex align-items-stretch">
                    <button
                        class="navbar-toggler navbar-toggler align-self-center"
                        type="button"
                        data-toggle="minimize"
                    >
                        <span class="mdi mdi-menu"></span>
                    </button>
                    <div class="search-field d-none d-md-block">
                        <form class="d-flex align-items-center h-100" action="#">
                            <div class="input-group">
                                <div class="input-group-prepend bg-transparent"></div>
                                <h1>Lohana Lagna</h1>
                            </div>
                        </form>
                    </div>
                    <ul class="navbar-nav navbar-nav-right">
                        <li class="nav-item nav-profile dropdown">
                            <a
                                class="nav-link dropdown-toggle"
                                id="profileDropdown"
                                href="#"
                                data-toggle="dropdown"
                                aria-expanded="false"
                            >
                                <div class="nav-profile-img">
                                    <img
                                        src="{{ url_for('static', filename='images/faces/face1.jpg') }}"
                                        alt="image"
                                    />
                                    <span class="availability-status online"></span>
                                </div>
                                <div class="nav-profile-text">
                                    <p class="mb-1 text-black"></p>
                                </div>
                            </a>
                            <div
                                class="dropdown-menu navbar-dropdown"
                                aria-labelledby="profileDropdown"
                            >
                                <div class="dropdown-divider"></div>
                                <a href="{{ url_for('logout') }}">Logout</a>
                                <i class="mdi mdi-logout mr-2 text-primary"></i>
                            </div>
                        </li>
                        <li class="nav-item d-none d-lg-block full-screen-link">
                            <a class="nav-link">
                                <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
                            </a>
                        </li>
                        <li class="nav-item nav-settings d-none d-lg-block">
                            <a class="nav-link" href="#">
                                <i class="mdi mdi-format-line-spacing"></i>
                            </a>
                        </li>
                    </ul>
                    <button
                        class="navbar-toggler navbar-toggler-right d-lg-none align-self-center"
                        type="button"
                        data-toggle="offcanvas"
                    >
                        <span class="mdi mdi-menu"></span>
                    </button>
                </div>
            </nav>
            <!-- partial -->
            <div class="container-fluid page-body-wrapper">
                <!-- partial:partials/_sidebar.html -->
                <nav class="sidebar sidebar-offcanvas" id="sidebar">
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <span class="menu-title">Dashboard</span>
                                <i class="mdi mdi-home menu-icon"></i>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/add_advert">
                                <span class="menu-title">Advertisement</span>
                                <i class="mdi mdi-crosshairs-gps menu-icon"></i>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/new_user">
                                <span class="menu-title">New Users</span>
                                <i class="mdi mdi-account-key menu-icon"></i>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- partial -->
                <div class="main-panel">
                    <div class="content-wrapper" style="background-color: #009788">
                        <div class="row" id="proBanner">
                            <div class="col-12">
                                <span class="d-flex align-items-center purchase-popup">
                                    <input type="text" id="search-input" class="form-control me-2" />
                                    <button type="submit" id="searchButton" class="btn btn-success">
                                        Search
                                    </button>
                                </span>
                            </div>
                        </div>

                        <div class="page-header">
                            <h3 class="page-title">
                                <span class="page-title-icon bg-gradient-success text-white mr-2">
                                    <i class="mdi mdi-home"></i>
                                </span>
                                Users Data
                            </h3>
                            <!--                        <button class="btn btn-success float-right" id="updateButton">Update data</button>-->
                        </div>
                        <div class="row">
                            <div class="col-md-12 stretch-card grid-margin">
                                <div class="card bg-gradient-success card-img-holder text-white">
                                    <div class="sub-main-w3" style="margin: 0 17vw"></div>

                                    <br /><br />
                                    <div class="box pagination">
                                        <div id="pagination-wrapper"></div>
                                    </div>

                                    <div class="table-wrapper" tabindex="0">
                                        <table border="5">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Mobile Number</th>
                                                    <th>Martial Status</th>
                                                    <th>City</th>
                                                    <th>Age</th>
                                                    <th>Is Premium</th>
                                                    <th>Delete User</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table-body"></tbody>
                                        </table>
                                    </div>
                                    <div id="pagination"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- partial -->
            </div>
            <!-- main-panel ends -->
        </div>

        <!-- partial:partials/_footer.html -->
        <footer class="footer">
            <div class="container-fluid clearfix">
                <span class="text-muted d-block text-center text-sm-left d-sm-inline-block"
                    >Copyright Â© 2021-2022</span
                >
                <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">
                    <a
                        href="https://github.com/JaydevRupareliya/LohanaLagnaPrivacyPolicy/blob/main/README.md"
                        target="_blank"
                        >Privacy Policy</a
                    >
                </span>
            </div>
        </footer>

        <!-- container-scroller -->
        <!-- plugins:js -->
        <script src="{{ url_for('static', filename='vendors/js/vendor.bundle.base.js')}}"></script>
        <!-- endinject -->
        <!-- Plugin js for this page -->
        <script src="{{ url_for('static', filename='vendors/chart.js/Chart.min.js')}}"></script>
        <!-- End plugin js for this page -->
        <!-- inject:js -->
        <script src="{{ url_for('static', filename='js/off-canvas.js')}}"></script>
        <script src="{{ url_for('static', filename='js/hoverable-collapse.js')}}"></script>
        <script src="{{ url_for('static', filename='js/misc.js')}}"></script>
        <!-- endinject -->
        <!-- Custom js for this page -->
        <script src="{{ url_for('static', filename='js/dashboard.js')}}"></script>
        <script src="{{ url_for('static', filename='js/todolist.js')}}"></script>

        <script>
            // $("#searchButton").click(function () {
            //     let filter = document.getElementById("myInput").value;
            //     filter = filter.toLowerCase();
            //     let d = JSON.parse(localStorage.getItem("user"));
            //     var table = $("#table-body");
            //     $("#table-body").empty();
            //     for (var i = 0; i < d.length; i++) {
            //         let td = d[i].mobileNumber;
            //         let namevalue = d[i].name.toLowerCase();
            //         let textvalue = td;
            //         if (textvalue.indexOf(filter) > -1 || namevalue.indexOf(filter) > -1) {
            //             var row = `<tr>
            //                                       <td>
            //                                         <a href="/editUser/${
            //                                             d[i].mobileNumber
            //                                         }" style="text-decoration:none; color:#0f3d5c;">  ${
            //                 d[i].name
            //             } </a>
            //                                       </td>
            //                                       <td class="mob">${d[i].mobileNumber}</td>
            //                                       <td>${d[i].martialStatus}</td>
            //                                       <td>${d[i].livingIn.split("-")[2]}, ${
            //                 d[i].livingIn.split("-")[1]
            //             }</td>
            //                                       <td>${d[i].age}</td>


            //                                       <td>
            //                                             <label class="switch">
            //                                                  ${
            //                                                      d[i].isPremium
            //                                                          ? `<input type="checkbox" class="togBtn1" id="togBtn1" name="premium" value="No" checked>`
            //                                                          : `<input type="checkbox" class="togBtn1" id="togBtn2" name="premium" value="Yes">`
            //                                                  }

            //                                                 <div class="slider round"></div>
            //                                             </label>

            //                                       </td>
            //                                       <td>
            //                                             <button type="submit" class="btn btn-danger">Delete</button>
            //                                     </td>
            //                                     </tr>
            //                                       `;
            //             table.append(row);
            //         }
            //     }
            // });
            // if (localStorage.getItem("user") == null) {
            //     console.log("not get userdata from local storage");
            //     // $.ajax('https://backend.lohanalagna.com/api/getAllUsers',   // request url

            var value;

var currentPage = 1;
var rowsPerPage = 100;
var totalRows = 0;
var totalPages = 0;
var myarr = [];

function renderTableData(page) {
  var startIndex = (page - 1) * rowsPerPage;
  var endIndex = startIndex + rowsPerPage;

  var tableBody = document.getElementById("table-body");
  tableBody.innerHTML = "";

  for (var i = startIndex; i < endIndex && i < totalRows; i++) {
    var row = `<tr>
      <td>
        <a href="/editUser/${myarr[i].mobileNumber}" style="text-decoration:none; color:#0f3d5c;">${myarr[i].name}</a>
      </td>
      <td class="mob">${myarr[i].mobileNumber}</td>
      <td>${myarr[i].martialStatus}</td>
      <td>${myarr[i].livingIn.split("-")[2]}, ${myarr[i].livingIn.split("-")[1]}</td>
      <td>${myarr[i].age}</td>
      <td>
        <label class="switch">
          ${
            myarr[i].isPremium
              ? `<input type="checkbox" class="togBtn1" name="premium" value="No" checked>`
              : `<input type="checkbox" class="togBtn1" name="premium" value="Yes">`
          }
          <div class="slider round"></div>
        </label>
      </td>
      <td>
        <button type="submit" class="btn btn-danger">Delete</button>
      </td>
    </tr>`;
    tableBody.innerHTML += row;
  }
}

function renderPagination() {
  var paginationDiv = document.getElementById("pagination");
  paginationDiv.innerHTML = "";

  for (var i = 1; i <= totalPages; i++) {
    var pageButton = document.createElement("button");
    pageButton.textContent = i;
    pageButton.classList.add("pagination-button");
    if (i === currentPage) {
      pageButton.classList.add("active");
    }
    pageButton.addEventListener("click", function () {
      currentPage = parseInt(this.textContent);
      renderTableData(currentPage);
      renderPagination();
    });
    paginationDiv.appendChild(pageButton);
  }
}

function searchTable() {
  var searchInput = document.getElementById("search-input").value.trim().toLowerCase();

  if (searchInput === "") {
    myarr = value;
    totalRows = myarr.length;
    totalPages = Math.ceil(totalRows / rowsPerPage);
    renderTableData(currentPage);
    renderPagination();
    return;
  }

  myarr = value.filter(function (item) {
    return (
      item.name.toLowerCase().includes(searchInput) ||
      item.mobileNumber.toLowerCase().includes(searchInput) ||
      item.martialStatus.toLowerCase().includes(searchInput) ||
      item.livingIn.toLowerCase().includes(searchInput) ||
      item.age.toString().includes(searchInput)
    );
  });

  totalRows = myarr.length;
  totalPages = Math.ceil(totalRows / rowsPerPage);
  renderTableData(1);
  renderPagination();
}

$.ajax("https://backend.lohanalagna.com/api/getAllUsers", {
  success: function (data, status, xhr) {
    value = data;
    myarr = value;
    totalRows = myarr.length;
    totalPages = Math.ceil(totalRows / rowsPerPage);

    renderTableData(currentPage);
    renderPagination();
  },
});

var searchInput = document.getElementById("search-input");
searchInput.addEventListener("input", searchTable);




            function buildTable() {
                var table = $("#table-body");

                
                

                pageButtons(data.pages);
            }

            $("body").append(
                '<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>'
            );
            $(window).on("load", function () {
                setTimeout(removeLoader, 3000); //wait for page load PLUS two seconds.
            });
            function removeLoader() {
                $("#loadingDiv").fadeOut(500, function () {
                    // fadeOut complete. Remove the loading div
                    $("#loadingDiv").remove(); //makes page more lightweight
                });
            }

            $(document).on("click", ".togBtn1", function () {
                console.log("checkbox got clicked");
                var mob_pre = $(this).closest("tr").children("td.mob").text();
                var checkbox_value = $(this).val();
                // console.log("hello3")
                console.log(mob_pre);
                // console.log("hello3");
                // console.log(checkbox_value);
                if (checkbox_value == "Yes") {
                    $(this).val("true");
                    checkbox_value = $(this).val();
                } else {
                    $(this).val("false");
                    checkbox_value = $(this).val();
                }
                console.log(checkbox_value);
                // var check_value = checkbox_value == "Yes";
                // console.log(user);
                // let a = JSON.parse(localStorage.getItem("user"));
                // console.log("a", typeof a, a);

                // let newobj = {};
                // console.log("newobj before loop:", newobj);

                // for (const i in a) {
                //   console.log("Iteration:", i);
                //   console.log("Current object:", a[i]);
                //   newobj[a[i].mobileNumber] = a[i];
                //   console.log("newobj during loop:", newobj);
                // }

                // console.log("newobj after loop:", newobj);

                if (checkbox_value != "" && mob_pre != "") {
                    // console.log("newobj has property");
                    // console.log("Before assignment:", newobj[mob_pre]);
                    // newobj[mob_pre].isPremium = !newobj[mob_pre].isPremium;
                    // console.log("After assignment:", newobj[mob_pre]);

                    // let newarr = Object.values(newobj);
                    // console.log("newarr", newarr);
                    // localStorage.setItem("user", JSON.stringify(newarr));

                    var params = {
                        mobileNumber: mob_pre,
                        makePremium: checkbox_value,
                    };
                    // var formData = JSON.stringify(params);
                    // console.log(formData);

                    $.ajax({
                        type: "POST",
                        url: "https://backend.lohanalagna.com/api/changePremiumStatus",
                        data: params,
                        success: function (data, status, xhr) {
                            console.log(data);
                            console.log("premium status changed");
                        },
                        error: function () {
                            console.log("premium status cannot be changed");
                        },
                    });
                } else {
                    console.log("Object or property is undefined.");
                }
            });

            $(document).on("click", ".btn-danger", function () {
                console.log("delete click");
                var mob_pre = $(this).closest("tr").children("td.mob").text();
                console.log(mob_pre);
                let a = JSON.parse(localStorage.getItem("user"));
                console.log("a", typeof a);
                let newobj = {};
                for (const i in a) {
                    newobj[a[i].mobileNumber] = a[i];
                }
                delete newobj[mob_pre];
                let newarr = Object.values(newobj);
                console.log("newarr", newarr);
                localStorage.setItem("user", JSON.stringify(newarr));

                location.href = `/delete/${mob_pre}`;
            });

                
        </script>
    </body>
</html>
